(function(q){var s=function(m,g,n){var c={version:"0.5.0",bind:function(a,b){a.modelBinder=new q(a,b);a.modelBinder.bind()},unbind:function(a){a.modelBinder&&a.modelBinder.unbind()}},o=function(a,b){var k=a;names=(""+b).split(".");g.each(names,function(a){a:{var b=k,c=b[a];if(c)g.isFunction(c)&&(c=c.apply(b));else if(b.get)c=b.get(a);else{k=void 0;break a}k=c}});k instanceof m.Model&&(k=k.id);return k},r=function(a,b,k){var d={};"undefined"!==typeof k&&null!==k?d[b]=k:d=b;g.each(d,function(k,c){b=
"set"+c.charAt(0).toUpperCase()+c.slice(1);g.isFunction(a[b])&&(a[b](k),delete d[c])});a.set(d)},q=function(a,b){this.config=new c.Configuration(b);this.modelBindings=[];this.elementBindings=[];this.bind=function(){var b=c.Conventions,d;for(d in b)if(b.hasOwnProperty(d)){var i=b[d];i.handler.bind.call(this,i.selector,a,a.model,this.config)}};this.unbind=function(){g.each(this.elementBindings,function(b){b.element.unbind(b.eventName,b.callback)});g.each(this.modelBindings,function(b){b.model.unbind(b.eventName,
b.callback)})};this.registerModelBinding=function(b,a,c){a="change:"+a;b.bind(a,c);this.modelBindings.push({model:b,eventName:a,callback:c})};this.registerDataBinding=function(b,a,c){b.bind(a,c);this.modelBindings.push({model:b,eventName:a,callback:c})};this.registerElementBinding=function(b,a){b.bind("change",a);this.elementBindings.push({element:b,eventName:"change",callback:a})}};c.Configuration=function(a){this.bindingAttrConfig={};g.extend(this.bindingAttrConfig,c.Configuration.bindindAttrConfig,
a);if(this.bindingAttrConfig.all){a=this.bindingAttrConfig.all;delete this.bindingAttrConfig.all;for(var b in this.bindingAttrConfig)this.bindingAttrConfig.hasOwnProperty(b)&&(this.bindingAttrConfig[b]=a)}this.getBindingAttr=function(b){return this.bindingAttrConfig[b]};this.getBindingValue=function(b,a){var c=this.getBindingAttr(a);return b.attr(c)}};c.Configuration.bindindAttrConfig={text:"id",textarea:"id",password:"id",radio:"name",checkbox:"id",select:"id",number:"id",range:"id",tel:"id",search:"id",
url:"id",email:"id"};c.Configuration.store=function(){c.Configuration.originalConfig=g.clone(c.Configuration.bindindAttrConfig)};c.Configuration.restore=function(){c.Configuration.bindindAttrConfig=c.Configuration.originalConfig};c.Configuration.configureBindingAttributes=function(a){a.all&&(this.configureAllBindingAttributes(a.all),delete a.all);g.extend(c.Configuration.bindindAttrConfig,a)};c.Configuration.configureAllBindingAttributes=function(a){var b=c.Configuration.bindindAttrConfig;b.text=
a;b.textarea=a;b.password=a;b.radio=a;b.checkbox=a;b.select=a;b.number=a;b.range=a;b.tel=a;b.search=a;b.url=a;b.email=a};var l=function(){var a={},b=function(b){var a=b[0].tagName.toLowerCase();if("input"==a&&(a=b.attr("type"),void 0==a||""==a))a="text";return a};a.bind=function(a,d,i,u){var j=this;d.$(a).each(function(){var a=d.$(this),e=b(a),f=u.getBindingValue(a,e);if(f){var p=c.getMediator(a),t=function(a,b){var c={},e=c,f=i;attr_names=a.split(".");a=attr_names.pop();g.each(attr_names,function(a){var b;
(b=f[a])?f=g.isFunction(b)?b():b:(e[a]=f.get(a)||{},e=e[a])});e[a]=p.parse(b);r(f,c)};j.registerModelBinding(i,f,function(b,c){a.val(p.render(c))});j.registerElementBinding(a,function(a){t(f,d.$(a.target).val())});e=o(i,f);"undefined"!==typeof e&&null!==e?a.val(p.render(e)):(e=a.val())&&t(f,e)}})};return a}(m),s=function(){return{bind:function(a,b,c,d){var i=this;b.$(a).each(function(){var a=b.$(this),j=d.getBindingValue(a,"select");if(j){var h=function(a,b,e){var f={},h=f,d=c;attr_names=a.split(".");
a=attr_names.pop();g.each(attr_names,function(a){var b;(b=d[a])?d=g.isFunction(b)?b():b:(h[a]=d.get(a)||{},h=h[a])});h[a]=b;h[a+"_text"]=e;r(d,f)};i.registerModelBinding(c,j,function(b,c){a.val(c)});i.registerElementBinding(a,function(a){var c=b.$(a.target),a=c.val(),c=c.find(":selected").text();h(j,a,c)});var e=o(c,j);if("undefined"!==typeof e&&null!==e)a.val(e);else{var e=a.val(),f=a.find(":selected").text();h(j,e,f)}}})}}}(m),v=function(){return{bind:function(a,b,c,d){var i=this,g=[];b.$(a).each(function(){var a=
b.$(this),h=d.getBindingValue(a,"radio");if(!g[h]){g[h]=!0;var e=d.getBindingAttr("radio");i.registerModelBinding(c,h,function(a,c){b.$("input[type=radio]["+e+"='"+h+"'][value='"+c+"']").attr("checked","checked")});var f=function(a,b){var e={};e[a]=b;r(c,e)},p=function(a){a=b.$(a.currentTarget);a.is(":checked")&&f(h,a.val())};b.$("input[type=radio]["+e+"='"+h+"']").each(function(){var a=n(this);i.registerElementBinding(a,p)});a=o(c,h);"undefined"!==typeof a&&null!==a?b.$("input[type=radio]["+e+"='"+
h+"'][value='"+a+"']").attr("checked","checked"):(a=b.$("input[type=radio]["+e+"='"+h+"']:checked").val(),f(h,a))}})}}}(m),w=function(){return{bind:function(a,b,c,d){var g=this;b.$(a).each(function(){var a=b.$(this);d.getBindingAttr("checkbox");var j=d.getBindingValue(a,"checkbox");if(j){var h=function(a,b){var e={};e[a]=b;r(c,e)};g.registerModelBinding(c,j,function(b,c){c?a.attr("checked","checked"):a.removeAttr("checked")});g.registerElementBinding(a,function(a){a=b.$(a.target).is(":checked")?!0:
!1;h(j,a)});var e=o(c,j);"undefined"!==typeof e&&null!==e?"undefined"!==typeof e&&null!==e&&!1!=e?a.attr("checked","checked"):a.removeAttr("checked"):(e=a.is(":checked")?!0:!1,h(j,e))}})}}}(m),x=function(a,b,g){var d={"default":""};c.Configuration.dataBindSubst=function(a){this.storeDataBindSubstConfig();b.extend(d,a)};c.Configuration.storeDataBindSubstConfig=function(){c.Configuration._dataBindSubstConfig=b.clone(d)};c.Configuration.restoreDataBindSubstConfig=function(){c.Configuration._dataBindSubstConfig&&
(d=c.Configuration._dataBindSubstConfig,delete c.Configuration._dataBindSubstConfig)};c.Configuration.getDataBindSubst=function(a,b){var c=b;void 0===b&&(c=d.hasOwnProperty(a)?d[a]:d["default"]);return c};var i=function(a,b,f){f=c.Configuration.getDataBindSubst(b,f);f=c.getMediator(a).render(f);switch(b){case "html":a.html(f);break;case "text":a.text(f);break;case "enabled":a.attr("disabled",!f);break;case "displayed":a[f?"show":"hide"]();break;case "hidden":a[f?"hide":"show"]();break;default:a.attr(b,
f)}},l=function(a){var e=[],f=c.Conventions.databind.selector.replace(/^(.*\[)([^\]]*)(].*)/g,"$2"),a=a.attr(f).split(";");b.each(a,function(a){a=g.trim(a).split(" ");1==a.length&&a.unshift("text");e.push({elementAttr:a[0],modelAttr:a[1]})});return e},j=function(a,b){var c={},d=b.modelAttr;0==d.indexOf("event:")?(c.name=d.substr(6),c.callback=function(c){i(a,b.elementAttr,c)}):(c.name="change:"+d,c.callback=function(c,d){i(a,b.elementAttr,d)});return c};return{bind:function(a,c,d){var g=this;c.$(a).each(function(){var a=
c.$(this),h=l(a);b.each(h,function(b){var c=j(a,b);g.registerDataBinding(d,c.name,c.callback);i(a,b.elementAttr,o(d,b.modelAttr))})})}}}(m,g,n);c.Conventions={text:{selector:"input:text",handler:l},textarea:{selector:"textarea",handler:l},password:{selector:"input:password",handler:l},radio:{selector:"input:radio",handler:v},checkbox:{selector:"input:checkbox",handler:w},select:{selector:"select",handler:s},databind:{selector:"*[data-bind]",handler:x},number:{selector:"input[type=number]",handler:l},
range:{selector:"input[type=range]",handler:l},tel:{selector:"input[type=tel]",handler:l},search:{selector:"input[type=search]",handler:l},url:{selector:"input[type=url]",handler:l},email:{selector:"input[type=email]",handler:l}};c.Mediators={};c.getMediator=function(a){a=c.Mediators[n(a).attr("data-mediator")]||{};a.parse=a.parse||function(a){return a};a.render=a.render||function(a){return a};return a};return c};"function"===typeof define&&define.amd?define(["backbone","underscore","jquery"],function(m,
g,n){return s(m,g,n)}):(q.Backbone=Backbone||{},q.Backbone.ModelBinding=s(Backbone,_,jQuery))})(this);
