(function(q){var r=function(l,i,n){var c={version:"0.5.0",bind:function(a,b){a.modelBinder=new q(a,b);a.modelBinder.bind()},unbind:function(a){a.modelBinder&&a.modelBinder.unbind()}},o=function(a,b){var m=a;names=(""+b).split(".");i.each(names,function(a){a:{var b=m,c=b[a];if(c)i.isFunction(c)&&(c=c.apply(b));else if(b.get)c=b.get(a);else{m=void 0;break a}m=c}});m instanceof l.Model&&(m=m.id);return m},q=function(a,b){this.config=new c.Configuration(b);this.modelBindings=[];this.elementBindings=[];
this.bind=function(){var b=c.Conventions,f;for(f in b)if(b.hasOwnProperty(f)){var j=b[f];j.handler.bind.call(this,j.selector,a,a.model,this.config)}};this.unbind=function(){i.each(this.elementBindings,function(b){b.element.unbind(b.eventName,b.callback)});i.each(this.modelBindings,function(b){b.model.unbind(b.eventName,b.callback)})};this.registerModelBinding=function(b,a,c){a="change:"+a;b.bind(a,c);this.modelBindings.push({model:b,eventName:a,callback:c})};this.registerDataBinding=function(b,a,
c){b.bind(a,c);this.modelBindings.push({model:b,eventName:a,callback:c})};this.registerElementBinding=function(b,a){b.bind("change",a);this.elementBindings.push({element:b,eventName:"change",callback:a})}};c.Configuration=function(a){this.bindingAttrConfig={};i.extend(this.bindingAttrConfig,c.Configuration.bindindAttrConfig,a);if(this.bindingAttrConfig.all){a=this.bindingAttrConfig.all;delete this.bindingAttrConfig.all;for(var b in this.bindingAttrConfig)this.bindingAttrConfig.hasOwnProperty(b)&&
(this.bindingAttrConfig[b]=a)}this.getBindingAttr=function(b){return this.bindingAttrConfig[b]};this.getBindingValue=function(b,a){var c=this.getBindingAttr(a);return b.attr(c)}};c.Configuration.bindindAttrConfig={text:"id",textarea:"id",password:"id",radio:"name",checkbox:"id",select:"id",number:"id",range:"id",tel:"id",search:"id",url:"id",email:"id"};c.Configuration.store=function(){c.Configuration.originalConfig=i.clone(c.Configuration.bindindAttrConfig)};c.Configuration.restore=function(){c.Configuration.bindindAttrConfig=
c.Configuration.originalConfig};c.Configuration.configureBindingAttributes=function(a){a.all&&(this.configureAllBindingAttributes(a.all),delete a.all);i.extend(c.Configuration.bindindAttrConfig,a)};c.Configuration.configureAllBindingAttributes=function(a){var b=c.Configuration.bindindAttrConfig;b.text=a;b.textarea=a;b.password=a;b.radio=a;b.checkbox=a;b.select=a;b.number=a;b.range=a;b.tel=a;b.search=a;b.url=a;b.email=a};var k=function(){var a={},b=function(b){var a=b[0].tagName.toLowerCase();if("input"==
a&&(a=b.attr("type"),void 0==a||""==a))a="text";return a};a.bind=function(a,f,j,t){var h=this;f.$(a).each(function(){var a=f.$(this),d=b(a),e=t.getBindingValue(a,d);if(e){var p=c.getMediator(a),s=function(a,b){var c={},e=c,d=j;attr_names=a.split(".");a=attr_names.pop();i.each(attr_names,function(a){var b;(b=d[a])?d=i.isFunction(b)?b():b:(e[a]=d.get(a)||{},e=e[a])});e[a]=p.parse(b);d.set(c)};h.registerModelBinding(j,e,function(b,c){a.val(p.render(c))});h.registerElementBinding(a,function(a){s(e,f.$(a.target).val())});
d=o(j,e);"undefined"!==typeof d&&null!==d?a.val(p.render(d)):(d=a.val())&&s(e,d)}})};return a}(l),r=function(){return{bind:function(a,b,c,f){var j=this;b.$(a).each(function(){var a=b.$(this),h=f.getBindingValue(a,"select");if(h){var g=function(a,b,e){var d={},g=d,h=c;attr_names=a.split(".");a=attr_names.pop();i.each(attr_names,function(a){var b;(b=h[a])?h=i.isFunction(b)?b():b:(g[a]=h.get(a)||{},g=g[a])});g[a]=b;g[a+"_text"]=e;h.set(d)};j.registerModelBinding(c,h,function(b,c){a.val(c)});j.registerElementBinding(a,
function(a){var c=b.$(a.target),a=c.val(),c=c.find(":selected").text();g(h,a,c)});var d=o(c,h);if("undefined"!==typeof d&&null!==d)a.val(d);else{var d=a.val(),e=a.find(":selected").text();g(h,d,e)}}})}}}(l),u=function(){return{bind:function(a,b,c,f){var j=this,i=[];b.$(a).each(function(){var a=b.$(this),g=f.getBindingValue(a,"radio");if(!i[g]){i[g]=!0;var d=f.getBindingAttr("radio");j.registerModelBinding(c,g,function(a,c){b.$("input[type=radio]["+d+"='"+g+"'][value='"+c+"']").attr("checked","checked")});
var e=function(a,b){var d={};d[a]=b;c.set(d)},p=function(a){a=b.$(a.currentTarget);a.is(":checked")&&e(g,a.val())};b.$("input[type=radio]["+d+"='"+g+"']").each(function(){var a=n(this);j.registerElementBinding(a,p)});a=o(c,g);"undefined"!==typeof a&&null!==a?b.$("input[type=radio]["+d+"='"+g+"'][value='"+a+"']").attr("checked","checked"):(a=b.$("input[type=radio]["+d+"='"+g+"']:checked").val(),e(g,a))}})}}}(l),v=function(){return{bind:function(a,b,c,f){var j=this;b.$(a).each(function(){var a=b.$(this);
f.getBindingAttr("checkbox");var h=f.getBindingValue(a,"checkbox");if(h){var g=function(a,b){var d={};d[a]=b;c.set(d)};j.registerModelBinding(c,h,function(b,c){c?a.attr("checked","checked"):a.removeAttr("checked")});j.registerElementBinding(a,function(a){a=b.$(a.target).is(":checked")?!0:!1;g(h,a)});if(c.attributes.hasOwnProperty(h)){var d=o(c,h);"undefined"!==typeof d&&null!==d&&!1!=d?a.attr("checked","checked"):a.removeAttr("checked")}else d=a.is(":checked")?!0:!1,g(h,d)}})}}}(l),w=function(a,b,
i){var f={"default":""};c.Configuration.dataBindSubst=function(a){this.storeDataBindSubstConfig();b.extend(f,a)};c.Configuration.storeDataBindSubstConfig=function(){c.Configuration._dataBindSubstConfig=b.clone(f)};c.Configuration.restoreDataBindSubstConfig=function(){c.Configuration._dataBindSubstConfig&&(f=c.Configuration._dataBindSubstConfig,delete c.Configuration._dataBindSubstConfig)};c.Configuration.getDataBindSubst=function(a,b){var c=b;void 0===b&&(c=f.hasOwnProperty(a)?f[a]:f["default"]);
return c};var j=function(a,b,e){e=c.Configuration.getDataBindSubst(b,e);e=c.getMediator(a).render(e);switch(b){case "html":a.html(e);break;case "text":a.text(e);break;case "enabled":a.attr("disabled",!e);break;case "displayed":a[e?"show":"hide"]();break;case "hidden":a[e?"hide":"show"]();break;default:a.attr(b,e)}},k=function(a){var d=[],e=c.Conventions.databind.selector.replace(/^(.*\[)([^\]]*)(].*)/g,"$2"),a=a.attr(e).split(";");b.each(a,function(a){a=i.trim(a).split(" ");1==a.length&&a.unshift("text");
d.push({elementAttr:a[0],modelAttr:a[1]})});return d},h=function(a,b){var c={},f=b.modelAttr;0==f.indexOf("event:")?(c.name=f.substr(6),c.callback=function(c){j(a,b.elementAttr,c)}):(c.name="change:"+f,c.callback=function(c,e){j(a,b.elementAttr,e)});return c};return{bind:function(a,c,e){var f=this;c.$(a).each(function(){var a=c.$(this),g=k(a);b.each(g,function(b){var c=h(a,b);f.registerDataBinding(e,c.name,c.callback);j(a,b.elementAttr,o(e,b.modelAttr))})})}}}(l,i,n);c.Conventions={text:{selector:"input:text",
handler:k},textarea:{selector:"textarea",handler:k},password:{selector:"input:password",handler:k},radio:{selector:"input:radio",handler:u},checkbox:{selector:"input:checkbox",handler:v},select:{selector:"select",handler:r},databind:{selector:"*[data-bind]",handler:w},number:{selector:"input[type=number]",handler:k},range:{selector:"input[type=range]",handler:k},tel:{selector:"input[type=tel]",handler:k},search:{selector:"input[type=search]",handler:k},url:{selector:"input[type=url]",handler:k},email:{selector:"input[type=email]",
handler:k}};c.Mediators={};c.getMediator=function(a){a=c.Mediators[n(a).attr("data-mediator")]||{};a.parse=a.parse||function(a){return a};a.render=a.render||function(a){return a};return a};return c};"function"===typeof define&&define.amd?define(["backbone","underscore","jquery"],function(l,i,n){return r(l,i,n)}):(q.Backbone=Backbone||{},q.Backbone.ModelBinding=r(Backbone,_,jQuery))})(this);
