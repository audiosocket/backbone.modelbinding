(function(q){var r=function(l,f,n){var c={version:"0.5.0",bind:function(a,b){a.modelBinder=new q(a,b);a.modelBinder.bind()},unbind:function(a){a.modelBinder&&a.modelBinder.unbind()}},o=function(a,b){var m=a;names=(""+b).split(".");f.each(names,function(a){a:{var b=m,c=b[a];if(c)f.isFunction(c)&&(c=c.apply(b));else if(b.get)c=b.get(a);else{m=void 0;break a}m=c}});m instanceof l.Model&&(m=m.id);return m},q=function(a,b){this.config=new c.Configuration(b);this.modelBindings=[];this.elementBindings=[];
this.bind=function(){var b=c.Conventions,g;for(g in b)if(b.hasOwnProperty(g)){var i=b[g];i.handler.bind.call(this,i.selector,a,a.model,this.config)}};this.unbind=function(){f.each(this.elementBindings,function(b){b.element.unbind(b.eventName,b.callback)});f.each(this.modelBindings,function(b){b.model.unbind(b.eventName,b.callback)})};this.registerModelBinding=function(b,a,c){a="change:"+a;b.bind(a,c);this.modelBindings.push({model:b,eventName:a,callback:c})};this.registerDataBinding=function(b,a,
c){b.bind(a,c);this.modelBindings.push({model:b,eventName:a,callback:c})};this.registerElementBinding=function(b,a){b.bind("change",a);this.elementBindings.push({element:b,eventName:"change",callback:a})}};c.Configuration=function(a){this.bindingAttrConfig={};f.extend(this.bindingAttrConfig,c.Configuration.bindindAttrConfig,a);if(this.bindingAttrConfig.all){a=this.bindingAttrConfig.all;delete this.bindingAttrConfig.all;for(var b in this.bindingAttrConfig)this.bindingAttrConfig.hasOwnProperty(b)&&
(this.bindingAttrConfig[b]=a)}this.getBindingAttr=function(b){return this.bindingAttrConfig[b]};this.getBindingValue=function(b,a){var c=this.getBindingAttr(a);return b.attr(c)}};c.Configuration.bindindAttrConfig={text:"id",textarea:"id",password:"id",radio:"name",checkbox:"id",select:"id",number:"id",range:"id",tel:"id",search:"id",url:"id",email:"id"};c.Configuration.store=function(){c.Configuration.originalConfig=f.clone(c.Configuration.bindindAttrConfig)};c.Configuration.restore=function(){c.Configuration.bindindAttrConfig=
c.Configuration.originalConfig};c.Configuration.configureBindingAttributes=function(a){a.all&&(this.configureAllBindingAttributes(a.all),delete a.all);f.extend(c.Configuration.bindindAttrConfig,a)};c.Configuration.configureAllBindingAttributes=function(a){var b=c.Configuration.bindindAttrConfig;b.text=a;b.textarea=a;b.password=a;b.radio=a;b.checkbox=a;b.select=a;b.number=a;b.range=a;b.tel=a;b.search=a;b.url=a;b.email=a};var j=function(){var a={},b=function(b){var a=b[0].tagName.toLowerCase();if("input"==
a&&(a=b.attr("type"),void 0==a||""==a))a="text";return a};a.bind=function(a,g,i,t){var k=this;g.$(a).each(function(){var a=g.$(this),d=b(a),e=t.getBindingValue(a,d);if(e){var p=c.getMediator(a),s=function(a,b){var c={},e=c,d=i;attr_names=a.split(".");a=attr_names.pop();f.each(attr_names,function(a){var b;(b=d[a])?d=f.isFunction(b)?b():b:(e[a]=d.get(a)||{},e=e[a])});e[a]=p.parse(b);d.set(c)};k.registerModelBinding(i,e,function(b,c){a.val(p.render(c))});k.registerElementBinding(a,function(a){s(e,g.$(a.target).val())});
d=o(i,e);"undefined"!==typeof d&&null!==d?a.val(p.render(d)):(d=a.val())&&s(e,d)}})};return a}(l),r=function(){return{bind:function(a,b,c,g){var i=this;b.$(a).each(function(){var a=b.$(this),k=g.getBindingValue(a,"select");if(k){var h=function(a,b,e){var d={},h=c;attr_names=a.split(".");a=attr_names.pop();f.each(attr_names,function(a){var b;(b=h[a])?h=f.isFunction(b)?b():b:(d[a]=h.get(a)||{},d=d[a])});d[a]=b;d[a+"_text"]=e;h.set(d)};i.registerModelBinding(c,k,function(b,c){a.val(c)});i.registerElementBinding(a,
function(a){var c=b.$(a.target),a=c.val(),c=c.find(":selected").text();h(k,a,c)});var d=o(c,k);if("undefined"!==typeof d&&null!==d)a.val(d);else{var d=a.val(),e=a.find(":selected").text();h(k,d,e)}}})}}}(l),u=function(){return{bind:function(a,b,c,g){var i=this,f=[];b.$(a).each(function(){var a=b.$(this),h=g.getBindingValue(a,"radio");if(!f[h]){f[h]=!0;var d=g.getBindingAttr("radio");i.registerModelBinding(c,h,function(a,c){b.$("input[type=radio]["+d+"='"+h+"'][value='"+c+"']").attr("checked","checked")});
var e=function(a,b){var d={};d[a]=b;c.set(d)},p=function(a){a=b.$(a.currentTarget);a.is(":checked")&&e(h,a.val())};b.$("input[type=radio]["+d+"='"+h+"']").each(function(){var a=n(this);i.registerElementBinding(a,p)});a=o(c,h);"undefined"!==typeof a&&null!==a?b.$("input[type=radio]["+d+"='"+h+"'][value='"+a+"']").attr("checked","checked"):(a=b.$("input[type=radio]["+d+"='"+h+"']:checked").val(),e(h,a))}})}}}(l),v=function(){return{bind:function(a,b,c,g){var i=this;b.$(a).each(function(){var a=b.$(this);
g.getBindingAttr("checkbox");var f=g.getBindingValue(a,"checkbox");if(f){var h=function(a,b){var d={};d[a]=b;c.set(d)};i.registerModelBinding(c,f,function(b,c){c?a.attr("checked","checked"):a.removeAttr("checked")});i.registerElementBinding(a,function(a){a=b.$(a.target).is(":checked")?!0:!1;h(f,a)});if(c.attributes.hasOwnProperty(f)){var d=o(c,f);"undefined"!==typeof d&&null!==d&&!1!=d?a.attr("checked","checked"):a.removeAttr("checked")}else d=a.is(":checked")?!0:!1,h(f,d)}})}}}(l),w=function(a,b,
f){var g={"default":""};c.Configuration.dataBindSubst=function(a){this.storeDataBindSubstConfig();b.extend(g,a)};c.Configuration.storeDataBindSubstConfig=function(){c.Configuration._dataBindSubstConfig=b.clone(g)};c.Configuration.restoreDataBindSubstConfig=function(){c.Configuration._dataBindSubstConfig&&(g=c.Configuration._dataBindSubstConfig,delete c.Configuration._dataBindSubstConfig)};c.Configuration.getDataBindSubst=function(a,b){var c=b;void 0===b&&(c=g.hasOwnProperty(a)?g[a]:g["default"]);
return c};var i=function(a,b,e){e=c.Configuration.getDataBindSubst(b,e);e=c.getMediator(a).render(e);switch(b){case "html":a.html(e);break;case "text":a.text(e);break;case "enabled":a.attr("disabled",!e);break;case "displayed":a[e?"show":"hide"]();break;case "hidden":a[e?"hide":"show"]();break;default:a.attr(b,e)}},j=function(a){var d=[],e=c.Conventions.databind.selector.replace(/^(.*\[)([^\]]*)(].*)/g,"$2"),a=a.attr(e).split(";");b.each(a,function(a){a=f.trim(a).split(" ");1==a.length&&a.unshift("text");
d.push({elementAttr:a[0],modelAttr:a[1]})});return d},k=function(a,b){var c={},f=b.modelAttr;0==f.indexOf("event:")?(c.name=f.substr(6),c.callback=function(c){i(a,b.elementAttr,c)}):(c.name="change:"+f,c.callback=function(c,e){i(a,b.elementAttr,e)});return c};return{bind:function(a,c,e){var f=this;c.$(a).each(function(){var a=c.$(this),g=j(a);b.each(g,function(b){var c=k(a,b);f.registerDataBinding(e,c.name,c.callback);i(a,b.elementAttr,o(e,b.modelAttr))})})}}}(l,f,n);c.Conventions={text:{selector:"input:text",
handler:j},textarea:{selector:"textarea",handler:j},password:{selector:"input:password",handler:j},radio:{selector:"input:radio",handler:u},checkbox:{selector:"input:checkbox",handler:v},select:{selector:"select",handler:r},databind:{selector:"*[data-bind]",handler:w},number:{selector:"input[type=number]",handler:j},range:{selector:"input[type=range]",handler:j},tel:{selector:"input[type=tel]",handler:j},search:{selector:"input[type=search]",handler:j},url:{selector:"input[type=url]",handler:j},email:{selector:"input[type=email]",
handler:j}};c.Mediators={};c.getMediator=function(a){a=c.Mediators[n(a).attr("data-mediator")]||{};a.parse=a.parse||function(a){return a};a.render=a.render||function(a){return a};return a};return c};"function"===typeof define&&define.amd?define(["backbone","underscore","jquery"],function(l,f,n){return r(l,f,n)}):(q.Backbone=Backbone||{},q.Backbone.ModelBinding=r(Backbone,_,jQuery))})(this);
